import React, { Component } from 'react';
import PropTypes from 'prop-types';
import classnames from 'classnames';

const MODAL_OPEN_CLASSNAME = 'modal-open';

class Modal extends Component {
  static propTypes = {
    title: PropTypes.node,
    header: PropTypes.node,
    footer: PropTypes.node,
    children: PropTypes.node.isRequired,
    className: PropTypes.string,
    overlayClassName: PropTypes.string,
    dialogClassName: PropTypes.string,
    contentClassName: PropTypes.string,
    titleClassName: PropTypes.string,
    headerClassName: PropTypes.string,
    bodyClassName: PropTypes.string,
    footerClassName: PropTypes.string,
    onDismiss: PropTypes.func,
    tabIndex: PropTypes.string,
    role: PropTypes.string
  };

  static defaultProps = {
    title: null,
    header: null,
    footer: null,
    className: null,
    overlayClassName: null,
    dialogClassName: null,
    contentClassName: null,
    titleClassName: null,
    headerClassName: null,
    bodyClassName: null,
    footerClassName: null,
    onDismiss: null,
    tabIndex: '-1',
    role: 'dialog'
  }

  state = {
    mounted: false
  }

  componentDidMount() {
    document.body.classList.add(MODAL_OPEN_CLASSNAME);
    this.setState({
      mounted: true
    });
  }

  componentWillUnmount() {
    document.body.classList.remove(MODAL_OPEN_CLASSNAME);
  }

  handleClickOutside = (e) => {
    const {
      onDismiss
    } = this.props;

    if (onDismiss) {
      onDismiss();
    }
  }

  render() {
    const {
      title,
      header,
      children,
      footer,
      className,
      overlayClassName,
      dialogClassName,
      contentClassName,
      titleClassName,
      headerClassName,
      bodyClassName,
      footerClassName,
      tabIndex,
      role,
      onDismiss, // eslint-disable-line no-unused-vars
      ...modalContainerAttributes
    } = this.props;

    const {
      mounted
    } = this.state;

    const containerClassName = classnames('modal', {
      'fade': mounted,
      'in': mounted,
      'visible': mounted
    }, className);

    const overlayClasses = classnames('modal-backdrop', 'fade', 'in', overlayClassName);
    const dialogClasses = classnames('modal-dialog', dialogClassName);
    const contentClasses = classnames('modal-content', contentClassName);
    const titleClasses = classnames('modal-title', titleClassName);
    const headerClasses = classnames('modal-header', headerClassName);
    const bodyClasses = classnames('modal-body', bodyClassName);
    const footerClasses = classnames('modal-footer', footerClassName);

    return (
      <div
        className={containerClassName}
        tabIndex={tabIndex}
        role={role}
        {...modalContainerAttributes}
      >
        <div className={ overlayClasses } onClick={this.handleClickOutside}></div>
        <div className={ dialogClasses }>
          <div className={ contentClasses }>
            {(title || header) && (
              <div className={ headerClasses }>
                {header || (
                  <h2 className={ titleClasses }>{title}</h2>
                )}
              </div>
            )}
            <div className={ bodyClasses }>
              {children}
            </div>
            {footer && (
              <div className={ footerClasses }>
                {footer}
              </div>
            )}
          </div>
        </div>
      </div>
    );
  }
}

export default Modal;
